<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Util.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">edu.cuny.hunter.log.tests.report</a> &gt; <a href="../index.html" class="el_bundle">edu.cuny.hunter.log.core</a> &gt; <a href="index.source.html" class="el_package">edu.cuny.hunter.log.core.utils</a> &gt; <span class="el_source">Util.java</span></div><h1>Util.java</h1><pre class="source lang-java linenums">package edu.cuny.hunter.log.core.utils;

import java.util.HashSet;
import java.util.List;
import java.util.Optional;
import java.util.Set;
import java.util.logging.Level;

import org.eclipse.core.runtime.IProgressMonitor;
import org.eclipse.jdt.core.IJavaProject;
import org.eclipse.jdt.core.JavaModelException;
import org.eclipse.jdt.core.dom.Expression;
import org.eclipse.jdt.core.dom.IMethodBinding;
import org.eclipse.jdt.core.dom.ITypeBinding;
import org.eclipse.jdt.core.dom.MethodInvocation;
import org.eclipse.jdt.internal.corext.codemanipulation.CodeGenerationSettings;
import org.eclipse.jdt.internal.ui.preferences.JavaPreferencesSettings;
import org.eclipse.ltk.core.refactoring.participants.ProcessorBasedRefactoring;
import edu.cuny.hunter.log.core.refactorings.LogRefactoringProcessor;

@SuppressWarnings(&quot;restriction&quot;)
<span class="nc" id="L22">public final class Util {</span>
	public static ProcessorBasedRefactoring createRefactoring(IJavaProject[] projects,
			Optional&lt;IProgressMonitor&gt; monitor) throws JavaModelException {
<span class="nc" id="L25">		LogRefactoringProcessor processor = createLoggingProcessor(projects, monitor);</span>
<span class="nc" id="L26">		return new ProcessorBasedRefactoring(processor);</span>
	}

	public static LogRefactoringProcessor createLoggingProcessor(IJavaProject[] projects,
			Optional&lt;IProgressMonitor&gt; monitor) throws JavaModelException {
<span class="nc bnc" id="L31" title="All 2 branches missed.">		if (projects.length &lt; 1)</span>
<span class="nc" id="L32">			throw new IllegalArgumentException(&quot;No projects.&quot;);</span>

<span class="nc" id="L34">		CodeGenerationSettings settings = JavaPreferencesSettings.getCodeGenerationSettings(projects[0]);</span>
<span class="nc" id="L35">		LogRefactoringProcessor processor = new LogRefactoringProcessor(projects, settings, monitor);</span>
<span class="nc" id="L36">		return processor;</span>
	}

	static Set&lt;ITypeBinding&gt; getAllClasses(ITypeBinding type) {
<span class="nc" id="L40">		Set&lt;ITypeBinding&gt; ret = new HashSet&lt;&gt;();</span>
<span class="nc" id="L41">		ITypeBinding superClass = type.getSuperclass();</span>

<span class="nc bnc" id="L43" title="All 2 branches missed.">		if (superClass != null) {</span>
<span class="nc" id="L44">			ret.add(superClass);</span>
<span class="nc" id="L45">			ret.addAll(getAllClasses(superClass));</span>
		}

<span class="nc" id="L48">		return ret;</span>
	}

	public static boolean isLoggingStatement(String methodName) {
<span class="nc" id="L52">		System.out.println(methodName);</span>
<span class="nc" id="L53">		return true;</span>
	}

	// if b is true, then it is junit test
	public static Level isLogExpression(MethodInvocation node, boolean b) {
<span class="pc bpc" id="L58" title="1 of 2 branches missed.">		if (!b) {</span>
<span class="nc" id="L59">			IMethodBinding methodBinding = node.resolveMethodBinding();</span>

<span class="nc bnc" id="L61" title="All 2 branches missed.">			if (methodBinding == null</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">					|| !methodBinding.getDeclaringClass().getQualifiedName().equals(&quot;java.util.logging.Logger&quot;))</span>
<span class="nc" id="L63">				return null;</span>
		}
<span class="fc" id="L65">		return isLogExpression(node);</span>
	}

	/**
	 * We only focus on the logging level, which is set by the developer. Hence, we
	 * do not record the logging level which is embedded by the logging package.
	 * e.g. each time we call method entering, a logging record which has &quot;FINER&quot;
	 * level is created.
	 * 
	 * @param node
	 * @return logging level
	 */
	public static Level isLogExpression(MethodInvocation node) {

<span class="fc" id="L79">		String methodName = node.getName().toString();</span>

<span class="fc bfc" id="L81" title="All 2 branches covered.">		if (methodName.equals(&quot;config&quot;))</span>
<span class="fc" id="L82">			return Level.CONFIG;</span>
<span class="pc bpc" id="L83" title="1 of 2 branches missed.">		if (methodName.equals(&quot;fine&quot;))</span>
<span class="nc" id="L84">			return Level.FINE;</span>
<span class="pc bpc" id="L85" title="1 of 2 branches missed.">		if (methodName.equals(&quot;finer&quot;))</span>
<span class="nc" id="L86">			return Level.FINER;</span>
<span class="pc bpc" id="L87" title="1 of 2 branches missed.">		if (methodName.equals(&quot;finest&quot;))</span>
<span class="nc" id="L88">			return Level.FINEST;</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">		if (methodName.equals(&quot;info&quot;))</span>
<span class="fc" id="L90">			return Level.INFO;</span>
<span class="pc bpc" id="L91" title="1 of 2 branches missed.">		if (methodName.equals(&quot;severe&quot;))</span>
<span class="nc" id="L92">			return Level.SEVERE;</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">		if (methodName.equals(&quot;warning&quot;))</span>
<span class="fc" id="L94">			return Level.WARNING;</span>

<span class="fc" id="L96">		List&lt;Expression&gt; arguments = node.arguments();</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">		if (arguments.size() == 0)</span>
<span class="fc" id="L98">			return null;</span>
<span class="fc" id="L99">		String firstArgument = arguments.get(0).toString();</span>

		// TODO: may need wala?
		// They should not be null
<span class="fc bfc" id="L103" title="All 2 branches covered.">		if (methodName.equals(&quot;log&quot;)) {</span>
<span class="fc" id="L104">			Level loggingLevel = getLogLevel(firstArgument);</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">			if (loggingLevel == null) {</span>
<span class="fc" id="L106">				throw new IllegalStateException(&quot;The log level cannot be detected.&quot;);</span>
			}
<span class="fc" id="L108">			return loggingLevel;</span>
		}
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">		if (methodName.equals(&quot;logp&quot;)) {</span>
<span class="nc" id="L111">			Level loggingLevel = getLogLevel(firstArgument);</span>
<span class="nc" id="L112">			return loggingLevel;</span>
		}
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">		if (methodName.equals(&quot;logrb&quot;)) {</span>
<span class="nc" id="L115">			Level loggingLevel = getLogLevel(firstArgument);</span>
<span class="nc" id="L116">			return loggingLevel;</span>
		}

<span class="fc" id="L119">		return null;</span>
	}

	/**
	 * Return a corresponding logging level of a string
	 * 
	 * @param argument
	 * @return logging level
	 */
	public static Level getLogLevel(String argument) {
<span class="fc bfc" id="L129" title="All 2 branches covered.">		if (argument.equals(&quot;Level.SEVERE&quot;))</span>
<span class="fc" id="L130">			return Level.SEVERE;</span>
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">		if (argument.equals(&quot;Level.WARNING&quot;))</span>
<span class="nc" id="L132">			return Level.WARNING;</span>
<span class="pc bpc" id="L133" title="1 of 2 branches missed.">		if (argument.equals(&quot;Level.INFO&quot;))</span>
<span class="nc" id="L134">			return Level.INFO;</span>
<span class="pc bpc" id="L135" title="1 of 2 branches missed.">		if (argument.equals(&quot;Level.CONFIG&quot;))</span>
<span class="nc" id="L136">			return Level.CONFIG;</span>
<span class="pc bpc" id="L137" title="1 of 2 branches missed.">		if (argument.equals(&quot;Level.FINE&quot;))</span>
<span class="nc" id="L138">			return Level.FINE;</span>
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">		if (argument.equals(&quot;Level.FINER&quot;))</span>
<span class="nc" id="L140">			return Level.FINER;</span>
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">		if (argument.equals(&quot;Level.FINEST&quot;))</span>
<span class="nc" id="L142">			return Level.FINEST;</span>
<span class="fc" id="L143">		return null;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>